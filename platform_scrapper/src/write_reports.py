import os
import json
import pprint


def clean_data(list_of_circle_sections, store="aaa", address='bb'):
    final_data = {}
    for item in list_of_circle_sections:
        if str(item)[0].isdigit():
            if type(list_of_circle_sections[item]) is list:
                final_data[item] = list_of_circle_sections[item]
        if type(item) is dict:
            # if type(list_of_circle_sections[item]) is dict:
            for key, value in item.items():
                if key:
                    for k1, v1 in value.items():
                        max_distance = max(v1.keys())
                        if key not in final_data:
                            final_data[key] = {}
                        if k1 not in final_data[key]:
                            final_data[key][k1] = {}
                        final_data[key][k1][max_distance] = v1[max_distance]
    res = {}
    for price in final_data:
        if type(final_data[price]) is list:
            res = final_data
            break
        if price not in res:
            res[price] = []
            for degree in final_data[price]:
                for km in final_data[price][degree]:
                    res[price].append(final_data[price][degree][km])

    filename = str(store) + str(address)
    with open(f"gd_{filename}.json", 'w') as file:
        json.dump(res, file)
    pprint.pprint(res)
    return res


def write_report(global_data, store, address, status, url, ecom_provider, service_options, index):
    store_l = str(store).capitalize()
    address_l = str(address).capitalize()
    filename = store_l + address_l
    liner = f"\n{60 * '-'}\n"
    with open(f"{index}glob.txt", "w") as file:
        if not global_data:
            result = f"Delivery info for {store} at address {address} NOT Found from {ecom_provider} ecommerse provider's server"
            json.dump(result, file, indent=2)
        else:
            json.dump(global_data, file, indent=2)
    with open(f"{index}{filename}.txt", "a") as f:
        report = f"Store - {store}{liner}Address - {address}{liner}{status}{liner}URL {url}{liner}Platform - {ecom_provider}{liner}Service options\n{service_options}{liner}Delivery Zones according to the price\nfirst number is the price, and in brackets are the coordinates of area according to that price \n"
        f.write(report)
        with open(f'{index}glob.txt', 'r') as glob_file:
            for line in glob_file:
                f.write(line)
    os.remove(f'{index}glob.txt')


x = [
  {
    "0": {
      "0": {
        "0.5": [
          [
            43.65777602652209,
            -79.39990639999999
          ]
        ],
        "0.9": [
          [
            43.66587642529875,
            -79.39990639999999
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67757698096437,
            -79.39990639999999
          ],
          "min order - 50.0"
        ]
      },
      "15": {
        "0.5": [
          [
            43.65762267382402,
            -79.39830213601407
          ]
        ],
        "0.9": [
          [
            43.66544702212702,
            -79.39541408580759
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67674881613725,
            -79.3912416748751
          ],
          "min order - 50.0"
        ]
      },
      "30": {
        "0.5": [
          [
            43.65717306868834,
            -79.39680722309068
          ]
        ],
        "0.9": [
          [
            43.66418808508424,
            -79.3912280551146
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67432078380081,
            -79.3831679011298
          ],
          "min order - 50.0"
        ]
      },
      "45": {
        "0.5": [
          [
            43.656457857042476,
            -79.39552355400066
          ]
        ],
        "0.9": [
          [
            43.66218543420805,
            -79.38763368124512
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67045841612373,
            -79.37623563312064
          ],
          "min order - 50.0"
        ]
      },
      "60": {
        "0.5": [
          [
            43.65552578768356,
            -79.39453861486324
          ]
        ],
        "0.9": [
          [
            43.659575581753025,
            -79.38487595221906
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.66542501690062,
            -79.37091741764097
          ],
          "min order - 50.0"
        ]
      }
    },
    "10.0": {
      "0": {
        "1.7000000000000002": [
          [
            43.69287767132369,
            -79.39990639999999
          ]
        ]
      },
      "15": {
        "1.7000000000000002": [
          [
            43.69152802068143,
            -79.38578410556777
          ]
        ]
      },
      "30": {
        "1.7000000000000002": [
          [
            43.68757109423048,
            -79.37262537989672
          ]
        ]
      },
      "45": {
        "1.7000000000000002": [
          [
            43.68127668384109,
            -79.36132781532717
          ]
        ]
      }
    }
  },
  {
    "0": {
      "72": {
        "0.5": [
          [
            43.65466629487248,
            -79.39401166042153
          ]
        ],
        "0.9": [
          [
            43.657168965898165,
            -79.38340068849165
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.660783616956124,
            -79.36807280950825
          ],
          "min order - 50.0"
        ]
      },
      "87": {
        "0.5": [
          [
            43.65351115618495,
            -79.39371691692504
          ]
        ],
        "0.9": [
          [
            43.65393455599782,
            -79.3825757690944
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.65454578489573,
            -79.36648283673242
          ],
          "min order - 50.0"
        ]
      },
      "102": {
        "0.5": [
          [
            43.65233998909363,
            -79.39384398129692
          ]
        ],
        "0.9": [
          [
            43.65065529761394,
            -79.38293193263193
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.648221519214886,
            -79.36717072093559
          ],
          "min order - 50.0"
        ]
      },
      "117": {
        "0.5": [
          [
            43.65123260535393,
            -79.39438417067302
          ]
        ],
        "0.9": [
          [
            43.64755466111651,
            -79.38444476439123
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.64224179354071,
            -79.37008910940524
          ],
          "min order - 50.0"
        ]
      },
      "132": {
        "0.5": [
          [
            43.650264465926625,
            -79.39530065344543
          ]
        ],
        "0.9": [
          [
            43.64484392701777,
            -79.38701105512051
          ],
          "min order - 50.0"
        ]
      }
    }
  },
  {
    "0": {
      "144": {
        "0.5": [
          [
            43.649634979617325,
            -79.39626355471147
          ]
        ],
        "0.9": [
          [
            43.64308141351329,
            -79.3897071460278
          ],
          "min order - 50.0"
        ]
      },
      "159": {
        "0.5": [
          [
            43.64907445181742,
            -79.39768540712784
          ]
        ],
        "0.9": [
          [
            43.64151198622222,
            -79.39368812145065
          ],
          "min order - 50.0"
        ]
      },
      "174": {
        "0.5": [
          [
            43.64880022082641,
            -79.39925858560734
          ]
        ],
        "0.9": [
          [
            43.64074416680697,
            -79.39809267551892
          ],
          "min order - 50.0"
        ]
      },
      "189": {
        "0.5": [
          [
            43.648830971131375,
            -79.40087590195662
          ]
        ],
        "0.9": [
          [
            43.64083026450697,
            -79.40262077388654
          ],
          "min order - 50.0"
        ]
      },
      "204": {
        "0.5": [
          [
            43.64916460759963,
            -79.4024271626338
          ]
        ],
        "0.9": [
          [
            43.64176441379501,
            -79.40696397840462
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.631075170250575,
            -79.41351599520026
          ],
          "min order - 50.0"
        ]
      }
    }
  },
  {
    "0": {
      "216": {
        "0.5": [
          [
            43.649634979617325,
            -79.40354924528852
          ]
        ],
        "0.9": [
          [
            43.64308141351329,
            -79.41010565397218
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.633615017451554,
            -79.41957453538959
          ],
          "min order - 50.0"
        ]
      },
      "231": {
        "0.5": [
          [
            43.65044361239105,
            -79.40472288778379
          ]
        ],
        "0.9": [
          [
            43.64534552507628,
            -79.41339183257773
          ],
          "min order - 50.0"
        ]
      },
      "246": {
        "0.5": [
          [
            43.65144525173511,
            -79.40556833981779
          ]
        ],
        "0.9": [
          [
            43.64815006150438,
            -79.41575927434648
          ],
          "min order - 50.0"
        ]
      },
      "261": {
        "0.5": [
          [
            43.65257164524315,
            -79.40602797437195
          ]
        ],
        "0.9": [
          [
            43.6513039304557,
            -79.41704657649358
          ],
          "min order - 50.0"
        ]
      },
      "276": {
        "0.5": [
          [
            43.6537460357423,
            -79.40607044804334
          ]
        ],
        "0.9": [
          [
            43.65459222065808,
            -79.4171658903358
          ],
          "min order - 50.0"
        ]
      }
    },
    "10.0": {
      "216": {
        "1.7000000000000002": [
          [
            43.621235702853234,
            -79.43195437786429
          ]
        ]
      },
      "231": {
        "1.3": [
          [
            43.637981402248094,
            -79.42591211237364
          ]
        ]
      },
      "246": {
        "1.3": [
          [
            43.64339004742911,
            -79.43047835084758
          ]
        ],
        "1.7000000000000002": [
          [
            43.63716502665494,
            -79.44972438686908
          ],
          "min order - 50.0"
        ]
      },
      "261": {
        "1.3": [
          [
            43.649472445525554,
            -79.43296185154286
          ]
        ],
        "1.7000000000000002": [
          [
            43.64707698024287,
            -79.45377330730452
          ],
          "min order - 50.0"
        ]
      },
      "276": {
        "1.3": [
          [
            43.65581414181672,
            -79.4331929653376
          ]
        ],
        "1.7000000000000002": [
          [
            43.65741158616603,
            -79.45415200372906
          ],
          "min order - 50.0"
        ]
      }
    }
  },
  {
    "0": {
      "288": {
        "0.5": [
          [
            43.65466629487248,
            -79.40580113957846
          ]
        ],
        "0.9": [
          [
            43.657168965898165,
            -79.41641211150834
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.660783616956124,
            -79.43173999049174
          ],
          "min order - 50.0"
        ]
      },
      "303": {
        "0.5": [
          [
            43.65572668128427,
            -79.40510465214922
          ]
        ],
        "0.9": [
          [
            43.66013809469836,
            -79.41446219106959
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.666509884243304,
            -79.42798006582528
          ],
          "min order - 50.0"
        ]
      },
      "318": {
        "0.5": [
          [
            43.656620045158185,
            -79.40405387018721
          ]
        ],
        "0.9": [
          [
            43.66263957311211,
            -79.41152006238802
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.671334278935255,
            -79.42230611897968
          ],
          "min order - 50.0"
        ]
      },
      "333": {
        "0.5": [
          [
            43.657285496730736,
            -79.40272039899772
          ]
        ],
        "0.9": [
          [
            43.664502893834424,
            -79.4077862039835
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67492793470412,
            -79.41510474443537
          ],
          "min order - 50.0"
        ]
      },
      "348": {
        "0.5": [
          [
            43.657677678549554,
            -79.40119512101415
          ]
        ],
        "0.9": [
          [
            43.66560104089775,
            -79.40351512391997
          ],
          "min order - 50.0"
        ],
        "1.3": [
          [
            43.67704586302771,
            -79.40686687606973
          ],
          "min order - 50.0"
        ]
      }
    },
    "10.0": {
      "288": {
        "1.7000000000000002": [
          [
            43.66551005114631,
            -79.45178571258373
          ]
        ]
      },
      "303": {
        "1.7000000000000002": [
          [
            43.67484189172025,
            -79.44565973227554
          ]
        ]
      },
      "318": {
        "1.7000000000000002": [
          [
            43.682704053778146,
            -79.43641362566987
          ]
        ]
      },
      "333": {
        "1.7000000000000002": [
          [
            43.68856055722744,
            -79.42467731074635
          ]
        ]
      }
    }
  }
]

clean_data(x)
# clean_data(null, "null31 CELINA ST", "The Peace Pipe")
